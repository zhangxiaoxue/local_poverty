function CensusMap(e){var a={apiKey:"28c21ea4173e99b69770dab94a59ab79544572e0",latitude:33.83,longitude:-84.4,city:"atlanta",mapId:"cd-google-map",tractTypes:[{id:1,label:"Chronic High Poverty",desp:"In 2000, these tracts had a 30% or greater poverty rate. By 2010, they were still high poverty."},{id:2,label:"Rebounding Neighborhoods",desp:"In 2000, these tracts had more than a 30% poverty rate. In 2010, they had a poverty rate of 15% or less."},{id:3,label:"New Poor Neighborhoods",desp:"In 2000, these tracts had less than a 30% poverty rate. In 2010, they had a poverty rate of 30% or more."},{id:4,label:"Fallen Stars",desp:"In 2000, these tracts had less than the average poverty rate (15%). In 2010, they had a poverty rate of 30% or more."},{id:5,label:"No Compared Data",desp:"Data from 2000 in these tracts have no matching data from 2010 because of the continual change in geography between successive censuses."}],colors:["#a52733","#0a6a60","#f46431","#f39c12","#cdcdcd","#f2f2f2"],activeColor:"#08AAC7",strokeColors:["#4f1a1f","#0b3632","#70341e","#5c1f1f","#1C2236","#1C2236"],mapZoom:10,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#b4d4e1"},{visibility:"on"}]}]};this.opts=$.extend({},a,e),this.data={economic:{},demographic:{}},this.activeTracts=[],this.init(),this.initListeners()}CensusMap.prototype={constructor:CensusMap,init:function(){this.initLoading()},initListeners:function(){$(".panel").on("click",".close",function(e){e.preventDefault();var a=$(".panel");$(".panel").animate({right:-a.width()},350),$("#cd-zoom-in, #cd-zoom-out, #cd-my-location").css("marginLeft",10)}),$(".modal").on("click",".close",function(e){e.preventDefault(),$(".modal").fadeOut()})},initMap:function(e){var a=this,t={center:{lat:a.opts.latitude,lng:a.opts.longitude},zoom:a.opts.mapZoom,styles:a.opts.styles,mapTypeControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}},o=new google.maps.Map(document.getElementById(a.opts.mapId),t),l=new google.maps.InfoWindow({maxWidth:250});o.data.addListener("mouseover",function(e){var a={name:e.feature.getProperty("name"),povertyRate2000:e.feature.getProperty("povertyRate2000"),povertyRate2010:e.feature.getProperty("povertyRate2010")};l.setContent(template("tpl-info-content",a)),l.setPosition(e.latLng),l.setOptions({pixelOffset:new google.maps.Size(0,(-30))}),l.open(o),o.data.revertStyle(),o.data.overrideStyle(e.feature,{strokeWeight:3,strokeOpacity:1})}),o.data.addListener("mouseout",function(e){l.close(),o.data.revertStyle()}),o.data.addListener("click",function(e){l.close(),console.log(e.feature);var t=e.feature.getProperty("GEOID"),o=e.feature.getProperty("tractTypeId"),r={},n=$("#panel-detail");if(e.feature.getProperty("isActive"))e.feature.setProperty("isActive",!1),a.activeTracts=$.grep(a.activeTracts,function(e){return e.geoId!=t});else{if(5===a.activeTracts.length)return alert("No more than 5 tracts could be compared"),!1;e.feature.setProperty("isActive",!0),a.activeTracts.push({geoId:t,name:e.feature.getProperty("NAME"),basename:e.feature.getProperty("BASENAME")})}$.each(a.opts.tractTypes,function(e,a){if(a.id==o)return void(r=a)});var i="";$.each(a.activeTracts,function(e,a){i+=0==e?"Census Tract: "+a.basename:" & "+a.basename}),a.activeTracts.length>1?n.html(template("tpl-panel-detail",{title:i,tractTypeData:""})):n.html(template("tpl-panel-detail",{title:i,tractTypeData:r}));var s=$("<div></div>");$.each(a.data.demographic.label,function(e){s.append('<div id="'+e+'"></div>')}),$.each(a.data.economic.label,function(e){s.append('<div id="'+e+'"></div>')}),$("#tract-charts").html(s),$.each(a.data.demographic.label,function(e){a.showBarChart("#"+e,"demographic",e)}),$.each(a.data.economic.label,function(e){a.showBarChart("#"+e,"economic",e)}),n.animate({right:0},700)});var r=document.getElementById("legend"),n=document.createElement("div");n.innerHTML=template("tpl-legend",{colors:a.opts.colors,strokeColors:a.opts.strokeColors}),r.appendChild(n),$(r).on("click",".help",function(e){e.preventDefault(),$("#tract-type-help").html(template("tpl-tract-type-help",{data:a.opts.tractTypes})).fadeIn()}),o.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(r),a.map=o,a.infowindow=l,a.showTract(e)},showTract:function(e){var a=this,t=function(){var t=30,o=15;$.getJSON("data/geo.json",function(l){a.map.data.addGeoJson(l),a.map.data.setStyle(function(e){var l=e.getProperty("GEOID"),r=a.data.economic[2e3][l],n=a.data.economic[2010][l],i=r?r.povertyRate[0].value:"unknown",s=n?n.povertyRate[0].value:"unknown",c=0,u=0;r&&n?(c=4,i>t&&s>t&&(u=1,c=0),i>t&&s<o&&(u=2,c=1),i<t&&s>t&&(u=3,c=2),i<o&&s>t&&(u=4,c=3)):c=5,e.setProperty("povertyRate2000",i),e.setProperty("povertyRate2010",s),e.setProperty("tractTypeId",u);var p=a.opts.colors[c],d=e.getProperty("isActive")?a.opts.activeColor:a.opts.strokeColors[c],v=e.getProperty("isActive")?3:1.5,C=e.getProperty("isActive")?1:.6;return{fillColor:p,fillOpacity:.7,strokeColor:d,strokeWeight:v,strokeOpacity:C}}),e()})},o={label:{income:"Household Income",povertyRate:"Poverty Rate",unemploymentRate:"Unemployment Rate",occupation:"Occupation",workerClass:"Class of Worker",commuting:"Commuting to Work"},2000:{},2010:{}},l={2000:!1,2010:!1},r={label:{age:"Age",race:"Race"},2000:{},2010:{}},n={2000:!1,2010:!1};$.getJSON("data/economic_data_2000.json",function(e){e.forEach(function(e,a){0!=a&&(o[2e3][e["GEO.id2"]]={geoLabel:e["GEO.display-label"],povertyRate:[{label:"Poverty rate",value:e.HC02_VC93}],unemploymentRate:[{label:"Unemployment rate",value:100*e.HC01_VC06/e.HC01_VC03}],commuting:[{label:"Car, truck, or van -- drove alone",value:e.HC02_VC18},{label:"Car, truck, or van -- carpooled",value:e.HC02_VC19},{label:"Public transportation (including taxicab)",value:e.HC02_VC20},{label:"Walked",value:e.HC02_VC21},{label:"Other means",value:e.HC02_VC22},{label:"Worked at home",value:e.HC02_VC23}],occupation:[{label:"Management, professional, and related occupations",value:e.HC02_VC27},{label:"Service occupations",value:e.HC02_VC28},{label:"Sales and office occupations",value:e.HC02_VC29},{label:"Natural resources, construction, and maintenance occupations",value:e.HC02_VC30+e.HC02_VC31},{label:"Production, transportation, and material moving occupations",value:e.HC02_VC32}],workerClass:[{label:"Private wage and salary workers",value:e.HC02_VC48},{label:"Government workers",value:e.HC02_VC49},{label:"Self-employed workers in own not incorporated business",value:e.HC02_VC50},{label:"Unpaid family workers",value:e.HC02_VC51}],income:[{label:"Less than $10,000",value:e.HC02_VC54},{label:"$10,000 to $14,999",value:e.HC02_VC55},{label:"$15,000 to $24,999",value:e.HC02_VC56},{label:"$25,000 to $34,999",value:e.HC02_VC57},{label:"$35,000 to $49,999",value:e.HC02_VC58},{label:"$50,000 to $74,999",value:e.HC02_VC59},{label:"$75,000 to $99,999",value:e.HC02_VC60},{label:"$100,000 to $149,999",value:e.HC02_VC61},{label:"$150,000 to $199,999",value:e.HC02_VC62},{label:"$200,000 or more",value:e.HC02_VC63}]})}),l[2e3]=!0,l[2010]&&(a.data.economic=o,t())}),$.getJSON("data/economic_data_2010.json",function(e){e.forEach(function(e,a){0!=a&&(o[2010][e["GEO.id2"]]={geoLabel:e["GEO.display-label"],povertyRate:[{label:"Poverty rate",value:e.HC03_VC161}],unemploymentRate:[{label:"Unemployment rate",value:100*e.HC01_VC07/e.HC01_VC04}],commuting:[{label:"Car, truck, or van -- drove alone",value:e.HC03_VC28},{label:"Car, truck, or van -- carpooled",value:e.HC03_VC29},{label:"Public transportation (including taxicab)",value:e.HC03_VC30},{label:"Walked",value:e.HC03_VC31},{label:"Other means",value:e.HC03_VC32},{label:"Worked at home",value:e.HC03_VC33}],occupation:[{label:"Management, professional, and related occupations",value:e.HC03_VC41},{label:"Service occupations",value:e.HC03_VC42},{label:"Sales and office occupations",value:e.HC03_VC43},{label:"Natural resources, construction, and maintenance occupations",value:e.HC03_VC44},{label:"Production, transportation, and material moving occupations",value:e.HC03_VC45}],workerClass:[{label:"Private wage and salary workers",value:e.HC03_VC67},{label:"Government workers",value:e.HC03_VC68},{label:"Self-employed workers in own not incorporated business",value:e.HC03_VC69},{label:"Unpaid family workers",value:e.HC03_VC70}],income:[{label:"Less than $10,000",value:e.HC03_VC75},{label:"$10,000 to $14,999",value:e.HC03_VC76},{label:"$15,000 to $24,999",value:e.HC03_VC77},{label:"$25,000 to $34,999",value:e.HC03_VC78},{label:"$35,000 to $49,999",value:e.HC03_VC79},{label:"$50,000 to $74,999",value:e.HC03_VC80},{label:"$75,000 to $99,999",value:e.HC03_VC81},{label:"$100,000 to $149,999",value:e.HC03_VC82},{label:"$150,000 to $199,999",value:e.HC03_VC83},{label:"$200,000 or more",value:e.HC03_VC84}]})}),l[2010]=!0,l[2e3]&&(a.data.economic=o,t())}),$.getJSON("data/demographic_data_2000.json",function(e){e.forEach(function(e,a){0!=a&&(r[2e3][e["GEO.id2"]]={age:[{label:"Median age (years)",value:e.HC02_VC18},{label:"Under 5 years",value:e.HC02_VC05},{label:"5 to 14 years",value:e.HC02_VC06+e.HC02_VC07},{label:"15 to 24 years",value:e.HC02_VC08+e.HC02_VC09},{label:"25 to 34 years",value:e.HC02_VC10},{label:"35 to 44 years",value:e.HC02_VC11},{label:"45 to 54 years",value:e.HC02_VC12},{label:"55 to 64 years",value:e.HC02_VC13+e.HC02_VC14},{label:"65 years and over",value:e.HC02_VC15+e.HC02_VC16+e.HC02_VC17}],race:[{label:"White",value:e.HC02_VC29},{label:"Black or African American",value:e.HC02_VC30},{label:"American Indian and Alaska Native",value:e.HC02_VC31},{label:"Asian",value:e.HC02_VC32},{label:"Native Hawaiian and Other Pacific Islander",value:e.HC02_VC40},{label:"Some other race",value:e.HC02_VC45}]})}),n[2e3]=!0,n[2010]&&(a.data.demographic=r)}),$.getJSON("data/demographic_data_2010.json",function(e){e.forEach(function(e,a){0!=a&&(r[2010][e["GEO.id2"]]={age:[{label:"Median age (years)",value:e.HD02_S020},{label:"Under 5 years",value:e.HD02_S002},{label:"5 to 14 years",value:e.HD02_S003+e.HD02_S004},{label:"15 to 24 years",value:e.HD02_S005+e.HD02_S006},{label:"25 to 34 years",value:e.HD02_S007+e.HD02_S008},{label:"35 to 44 years",value:e.HD02_S009+e.HD02_S010},{label:"45 to 54 years",value:e.HD02_S011+e.HD02_S012},{label:"55 to 64 years",value:e.HD02_S013+e.HD02_S014},{label:"65 years and over",value:e.HD02_S015+e.HD02_S016+e.HD02_S017+e.HD02_S018}],race:[{label:"White",value:e.HD02_S078},{label:"Black or African American",value:e.HD02_S079},{label:"American Indian and Alaska Native",value:e.HD02_S080},{label:"Asian",value:e.HD02_S081},{label:"Native Hawaiian and Other Pacific Islander",value:e.HD02_S089},{label:"Some other race",value:e.HD02_S094}]})}),n[2010]=!0,n[2e3]&&(a.data.demographic=r)})},initLoading:function(){NProgress.configure({showSpinner:!1}),NProgress.configure({minimum:.1}),$(document).ajaxStart(function(){NProgress.start()}).ajaxComplete(function(e,a,t){NProgress.done()})},addLoading:function(){NProgress.start()},removeLoading:function(){NProgress.done()},showBarChart:function(e,a,t){function o(e,a,t,o){$(e).highcharts({chart:{width:420,type:"column"},title:{text:a},subtitle:{text:'Source: <a href="http://www.census.gov/" target="_blank">US Census</a>'},xAxis:{categories:t,title:{text:null},crosshair:!0},yAxis:{min:0,title:{text:"Percent (%)",align:"high"},labels:{overflow:"justify"}},tooltip:{pointFormat:'<span style="color:{point.color}">●</span> {series.name}: <b>{point.y:.2f}</b> %<br/>',shared:!0},plotOptions:{bar:{dataLabels:{enabled:!0}}},legend:{layout:"vertical",align:"right",verticalAlign:"top",x:-2,y:40,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},credits:{enabled:!1},series:o})}var l=this,r=[],n=[],i=this.data[a],s=i.label[t];if(0==l.activeTracts.length)return void $("#tract-charts").html("Please choose at least one tract");if(1==l.activeTracts.length){var c=l.activeTracts[0].geoId,u=[],p=[];i[2e3][c]&&(i[2e3][c][t].forEach(function(e){r.push(e.label),u.push(e.value)}),n.push({name:"Year 2000",data:u})),i[2010][c]&&(i[2010][c][t].forEach(function(e){p.push(e.value)}),n.push({name:"Year 2010",data:p})),o(e,s,r,n)}else{var d=["2000","2010"];$(e).html('<div class="2000"></div><div class="2010"></div>'),$.each(d,function(a,c){n=[];var c=c,u=s+" (Year "+c+")";$.each(l.activeTracts,function(e,o){var l=o.geoId,s=[];0===e&&0===a&&i[2e3][l]&&i[2e3][l][t].forEach(function(e){r.push(e.label)}),i[c][l]&&i[c][l][t].forEach(function(e){s.push(e.value)});var u={name:o.name,data:s};n.push(u)});var p=$("."+c,e);o(p,u,r,n)})}}},$(function(){function e(){$(".preloader-icon").delay(800).fadeOut("normal",function(){$(".preloader").fadeOut()})}if(NProgress.configure({showSpinner:!1}),NProgress.configure({minimum:.1}),$(document).ajaxStart(function(){NProgress.start()}).ajaxComplete(function(e,a,t){NProgress.done()}),$("#cd-google-map").length){var a=new CensusMap;google.load("maps","3",{other_params:"libraries=places",callback:function(){a.initMap(e)}})}});